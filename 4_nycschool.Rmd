--- 
title: "Analysing perceptions of NYC schools"
author: "Uni Lee"
date: "12/13/2020"
output: html_document
---

```{r setup, include=FALSE, warning=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(readxl)
library(janitor)
library(dplyr)
library(corrplot)
```
# Introduction

In this guided project, we will answer the following research questions by analyzing 4 datasets on demographic and test scores from the [New York City Department of Education](https://www.schools.nyc.gov). 


* Do student, teacher, and parent perceptions of NYC school quality appear to be related to demographic and academic success metrics?
* Do students, teachers, and parents have similar perceptions of NYC school quality?

# Data

The NYC Department of Education surveys all parents, teachers and students in grades 6-12 to assess  the community's opinions on academic expectations, communication, engagement, and safety and respect. The survey results can be downloaded [here](https://data.cityofnewyork.us/Education/2011-NYC-School-Survey/mnz3-dyi8). 

We will also use a combined dataset that we cleaned during the Dataquest mission. This dataset contains information on each school and academic performance. The data can be downloaded [here](https://data.world/dataquest/nyc-schools-data/workspace/file?filename=combined.csv).

```{r}
# Survey data for "general education" schools
gened_raw<- read_excel("data/4_nycschool/masterfile11_gened_final.xlsx", sheet=1, na="NA", skip=2) %>% clean_names()

# Survey data for "special education" schools (district 75)
sped_raw <- read_excel("data/4_nycschool/masterfile11_d75_final.xlsx", sheet=1, na="NA", skip=2) %>% clean_names()

# Cleaned and combined dataset on academic performance of NYC schools
combined_raw <- read.csv("data/4_nycschool/combined.csv") %>% clean_names
```

## Processing data

Variables related to the research questions are:
* Information on school (dbn, school_name)
* School demographics 
 + Percentage of black, asian, hispanic and white students (ends with "_per")
 + 
 
* academic success metrics
 + average sat scores (avg_sat_score)

* Perception of school quality by parents (p), students (s) and teachers (t). We will create a new variable that gives composite scores of the following sub-scores.
 + Safety and Respect scores (starts with "saf")
 + Communication scores (starts with "com")
 + Engagement scores (starts with "eng")
 + Academic expectations ("starts with "aca")

```{r}
# Create a new variable for composite scores for perception of the quality of education 


# Select variables necessary for analysis. 
gened <- gened_raw %>% select(dbn, starts_with("saf"), starts_with("com"), starts_with("eng"), starts_with("aca"))
sped <- sped_raw %>%  select(dbn, starts_with("saf"), starts_with("com"), starts_with("eng"), starts_with("aca"))
combined <- combined_raw %>% select(dbn, school_name, avg_sat_score, ends_with("_per")) 


# Combine the general education and District 75 survey dataframes and school information.
survey_all <- bind_rows(gened, sped) 
# Used "inner_join" function in order to retain data on schools that have both demographic information and perception of quality. 
survey_all <- inner_join(combined, survey_all, by="dbn")

# How many missing values?
sapply(survey_all, function(x) sum(is.na(x)))
```

# Analysis
## Do student, teacher, and parent perceptions of NYC school quality appear to be related to demographic and academic success metrics?

To answer this question, we can calculate Pearson correlation coefficient for relevant variables. This statistic measures linear correlation between two variables. We can also visualize correlations among variables using corrplot function from dplyr package.


```{r}
# Compute Pearson's correlation coefficient
cor(survey_all[,3:25])
```

